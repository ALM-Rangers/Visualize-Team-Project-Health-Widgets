define(["TFS/Build/Contracts","TFS/Build/RestClient"],function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=10)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){var i,o;i=[n,e,n(3)],void 0!==(o=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.disableTelemetry="false",this.disableAjaxTracking="false",this.enableDebug="false"}return t}();e.TelemetryClientSettings=i;var o=function(){function t(){this.IsAvailable=!0}return t.getClient=function(e){return this._instance||(console.log("Creating new TelemetryClient!"),this._instance=new t,this._instance.Init(e)),this._instance},t.prototype.Init=function(t){console.log("TelemetryClient settings key: "+t.key.substring(0,8)+"************"),console.log("TelemetryClient settings extension context: "+t.extensioncontext),console.log("TelemetryClient settings disableTelemetry: "+("true"===t.disableTelemetry)),console.log("TelemetryClient settings disableAjaxTracking: "+("true"===t.disableAjaxTracking)),console.log("TelemetryClient settings enableDebug: "+("true"===t.enableDebug));var e={instrumentationKey:t.key,disableTelemetry:"true"===t.disableTelemetry,disableAjaxTracking:"true"===t.disableAjaxTracking,enableDebug:"true"===t.enableDebug};this.ExtensionContext=t.extensioncontext;try{var i=VSS.getWebContext();n.AppInsights.downloadAndSetup(e),n.AppInsights.setAuthenticatedUserContext(i.user.id,i.collection.id)}catch(t){console.log(t)}},t.prototype.trackPageView=function(t,e,i,o,s){try{n.AppInsights.trackPageView(this.ExtensionContext+"."+t,e,i,o,s),n.AppInsights.flush()}catch(t){console.log(t)}},t.prototype.trackEvent=function(t,e,i){try{console.log("Tracking event: "+this.ExtensionContext+"."+t),n.AppInsights.trackEvent(this.ExtensionContext+"."+t,e,i),n.AppInsights.flush()}catch(t){console.log(t)}},t.prototype.trackException=function(t,e,i,o){try{console.error(t);var s={name:this.ExtensionContext+"."+e,message:t};n.AppInsights.trackException(s,e,i,o),n.AppInsights.flush()}catch(t){console.log(t)}},t.prototype.trackMetric=function(t,e,i,o,s,a){try{n.AppInsights.trackMetric(this.ExtensionContext+"."+t,e,i,o,s,a),n.AppInsights.flush()}catch(t){console.log(t)}},t}();e.TelemetryClient=o}.apply(e,i))&&(t.exports=o)},function(t,e,n){"use strict";var i,o,s;!function(t){t.ApplicationInsights||(t.ApplicationInsights={})}(s||(s={}));var s;!function(t){!function(t){var e=function(){function t(){}return t}();t.Base=e}(t.Telemetry||(t.Telemetry={}))}(s||(s={}));var s;!function(t){!function(t){var e=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}();t.Envelope=e}(t.Telemetry||(t.Telemetry={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){!function(t){t.Context||(t.Context={})}(t.ApplicationInsights||(t.ApplicationInsights={}))}(s||(s={}));var s;!function(t){t.ApplicationInsights||(t.ApplicationInsights={})}(s||(s={}));var s;!function(t){t.ApplicationInsights||(t.ApplicationInsights={})}(s||(s={}));var s;!function(t){t.ApplicationInsights||(t.ApplicationInsights={})}(s||(s={}));var a;!function(t){!function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"}(t.SeverityLevel||(t.SeverityLevel={}))}(a||(a={}));var s;!function(t){t.ApplicationInsights||(t.ApplicationInsights={})}(s||(s={})),i=[n,e],void 0!==(o=function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t._createLazyMethod=function(e){var n=window[t.appInsightsName];n[e]=function(){var t=arguments;n.queue?n.queue.push(function(){return n[e].apply(n,t)}):n[e].apply(n,t)}},t._defineLazyMethods=function(){var e=window[t.appInsightsName];try{e.cookie=document.cookie}catch(t){}e.queue=[];for(var n=["clearAuthenticatedUserContext","flush","setAuthenticatedUserContext","startTrackEvent","startTrackPage","stopTrackEvent","stopTrackPage","trackDependency","trackEvent","trackException","trackMetric","trackPageView","trackTrace"];n.length;)t._createLazyMethod(n.pop())},t._download=function(e){t.appInsightsInstance.config=e;var n=window[t.appInsightsName];if(n.queue||(n.queue=[]),setTimeout(function(){var t=document.createElement("script");t.src=e.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",document.head.appendChild(t)}),!e.disableExceptionTracking){t._createLazyMethod("_onerror");var i=window.onerror;window.onerror=function(t,e,o,s,a){var r=i&&i(t,e,o,s,a);return!0!==r&&n._onerror(t,e,o,s,a),r}}},Object.defineProperty(t,"appInsightsInstance",{get:function(){if("undefined"!=typeof window)return window[t.appInsightsName]||(window[t.appInsightsName]={downloadAndSetup:t._download,_defineLazyMethods:t._defineLazyMethods},t._defineLazyMethods()),window[t.appInsightsName]},enumerable:!0,configurable:!0}),t.appInsightsInitialized=!1,t.appInsightsName="appInsights",t}();e.AppInsights=n.appInsightsInstance}.apply(e,i))&&(t.exports=o)},function(t,e,n){var i,o;i=[n,e],void 0!==(o=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.settings={disableAjaxTracking:"false",disableTelemetry:"false",enableDebug:"false",extensioncontext:"FolderManagement",key:"__InstrumentationKey__"}}.apply(e,i))&&(t.exports=o)},,,,,,function(t,e,n){var i,o,s=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,s){function a(t){try{l(i.next(t))}catch(t){s(t)}}function r(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,r)}l((i=i.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,s&&(a=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(s,n[1])).done)return a;switch(s=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],s=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,s,a,r,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r};i=[n,e,n(2),n(0),n(1),n(4)],void 0!==(o=function(t,e,n,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),VSS.require(["TFS/Dashboards/WidgetHelpers"],function(t){t.IncludeWidgetStyles(),VSS.register("TPHealth-DetailsWidget",function(){return new l(t)}),VSS.notifyLoadSucceeded()});var l=function(){function t(t){this.WidgetHelpers=t}return t.prototype.load=function(t){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return n.TelemetryClient.getClient(r.settings).trackPageView("BuildDetails"),[4,this.ShowBuildDetails(t)];case 1:return e.sent(),[2,this.WidgetHelpers.WidgetStatusHelper.Success()]}})})},t.prototype.reload=function(t){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.ShowBuildDetails(t)];case 1:return e.sent(),[2,this.WidgetHelpers.WidgetStatusHelper.Success()]}})})},t.prototype.ShowBuildDetails=function(t){return s(this,void 0,void 0,function(){var e,n,i,s,r,l,u;return a(this,function(a){switch(a.label){case 0:return e=o.getClient(),(n=VSS.getWebContext(),null==(i=JSON.parse(t.customSettings.data)))?(this.setNoDetails(),[2]):(s=[i.definitionId],[4,e.getBuilds(n.project.name,s,null,null,null,null,null,null,null,null,null,null,null,null,null,1)]);case 1:return r=a.sent(),1===r.length?(l=r[0],this.setDetails(l),this.setStatusColor(l),this.setNavigateUrl(l),[2]):[4,e.getDefinition(i.definitionId,n.project.name)];case 2:return(u=a.sent())?(this.setDetailsFromDefinition(u),this.setStatusColorFromDefinition(u),this.setNavigateUrlFromDefinition(u),[2]):(this.setNoDetails(),[2])}})})},t.prototype.setNavigateUrl=function(t){t&&t._links&&t._links.web&&VSS.getService(VSS.ServiceIds.Navigation).then(function(e){$("#buildDefinitionNavigateUrl").on("click",function(n){n.preventDefault(),e.openNewWindow(t._links.web.href,"")})})},t.prototype.setNavigateUrlFromDefinition=function(t){t&&t._links&&t._links.web&&VSS.getService(VSS.ServiceIds.Navigation).then(function(e){$("#buildDefinitionNavigateUrl").on("click",function(n){n.preventDefault(),e.openNewWindow(t._links.web.href,"")})})},t.prototype.setStatusColor=function(t){var e=$("#root"),n=$("#buildStatus"),o=$("#buildDefinitionName");e.removeClass("success partial fail building"),n.removeClass("build-status-succeeded build-status-building build-status-failed"),t.status===i.BuildStatus.Completed?t.result===i.BuildResult.Succeeded?(e.addClass("success"),n.addClass("build-status-succeeded"),o.addClass("build-definition-name-success")):t.result===i.BuildResult.PartiallySucceeded?(e.addClass("partial"),n.addClass("build-status-failed"),o.addClass("build-definition-name-failed")):t.result!==i.BuildResult.Failed&&t.result!==i.BuildResult.Canceled||(e.addClass("fail"),n.addClass("build-status-failed"),o.addClass("build-definition-name-failed")):t.status!==i.BuildStatus.InProgress&&t.status!==i.BuildStatus.NotStarted||(e.addClass("building"),n.addClass("build-status-building"),o.addClass("build-definition-name-building"))},t.prototype.setStatusColorFromDefinition=function(t){var e=$("#root"),n=$("#buildStatus"),i=$("#buildDefinitionName");e.addClass("no-definition"),n.addClass("build-status-unknown"),i.addClass("build-definition-name-unknown")},t.prototype.setNoDetails=function(){$("#root").removeClass("success partial fail building"),$("#root").addClass("no-builds"),$("#nodata").text("No builds found"),$("#details").hide()},t.prototype.setDetails=function(t){$("#details").show(),$("#buildDefinitionName").text(t.definition.name),$("#buildVersion").text(t.buildNumber),$("#buildQueuedBy").text(t.requestedFor.displayName),t.finishTime&&$("#buildCompleted").text(t.finishTime.toISOString().slice(0,10)),$("#root").removeClass("no-builds"),$("#nodata").text(""),t.definition.name.length>91&&$("#buildDefinitionName").addClass("reallySmall-text")},t.prototype.setDetailsFromDefinition=function(t){$("#details").show(),$("#buildDefinitionName").text(t.name),$("#buildVersion").text(""),$("#buildQueuedBy").text(""),$("#root").removeClass("no-builds"),$("#nodata").text(""),t.name.length>91&&$("#buildDefinitionName").addClass("reallySmall-text")},t}();e.DetailsWidget=l}.apply(e,i))&&(t.exports=o)}])});